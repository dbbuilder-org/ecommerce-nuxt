<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <!-- Cache control - force revalidation -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <link rel="icon" type="image/png" href="<%= BASE_URL %>images/SV-logoicon-Small.png">
    <title>ECommerce</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Shop quality educational products, uniforms, school supplies, technology, and course materials. Secure online ordering with multiple payment options.">
    <meta name="keywords" content="school bookstore, educational products, textbooks, uniforms, school supplies, online ordering">
    <meta name="author" content="SchoolVision">

    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="School Bookstore">
    <meta property="og:title" content="School Bookstore - Quality Educational Products">
    <meta property="og:description" content="Shop quality educational products, uniforms, school supplies, technology, and course materials. Secure online ordering with multiple payment options.">
    <meta property="og:url" content="https://ecommerce-demo.schoolvision.io">
    <meta property="og:image" content="https://ecommerce-demo.schoolvision.io/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="School Bookstore - Quality Educational Products">
    <meta name="twitter:description" content="Shop quality educational products, uniforms, school supplies, and course materials.">
    <meta name="twitter:image" content="https://ecommerce-demo.schoolvision.io/images/og-image.jpg">

    <!-- Preload Critical Resources for Performance -->
    <link rel="preconnect" href="https://paymentapi-ecommerce.schoolvision.io" crossorigin>
    <link rel="dns-prefetch" href="https://paymentapi-ecommerce.schoolvision.io">

    <!-- Preload LCP Hero Background Image -->
    <!-- Note: Actual path will be determined by Vue CLI build process -->
    <!-- This improves Largest Contentful Paint (LCP) metric -->
    <link rel="preload" as="image" href="<%= BASE_URL %>img/hero-background.jpg" fetchpriority="high">

    <!-- PWA Manifest -->
    <link rel="manifest" href="<%= BASE_URL %>manifest.json">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#7EB3D7">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SV Shop">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="<%= BASE_URL %>images/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="<%= BASE_URL %>images/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="<%= BASE_URL %>images/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="<%= BASE_URL %>images/icons/icon-192x192.png">

     <!-- makes the config.js work -->
     <script type="text/javascript">
      (function() {
        var cachebuster = Math.round(new Date().getTime() / 1000);
        var configFile = 'config.js'; // default

        // Theme URL Parameter Detection
        // Allows runtime theme switching via ?theme=westmoreland_v2 (or westmoreland2)
        var urlParams = new URLSearchParams(window.location.search);
        var themeParam = urlParams.get('theme');
        if (themeParam) {
          // Normalize theme name: support both westmoreland_v2 and westmoreland2 formats
          var normalizedTheme = themeParam.replace(/_v(\d+)$/, '$1').replace(/-v(\d+)$/, '$1');
          window.VUE_APP_THEME = normalizedTheme;
          console.log('Theme override from URL:', themeParam, '→', normalizedTheme);
        }

        // Helper functions for cookie management
        function setCookie(name, value, days) {
          var expires = "";
          if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
          }
          document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
          var nameEQ = name + "=";
          var ca = document.cookie.split(';');
          for(var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
          }
          return null;
        }

        // Map school identifiers to config files
        var configMap = {
          'westmoreland': 'config.westmoreland.js',
          'windermere': 'config.windermere.js',
          'coastalab': 'config.coastalAB.js',
          'test': 'config.test.js',
          'demo': 'config.demo.js'
        };

        // Map staging hostnames to staging config files
        var stagingHostMap = {
          'westmoreland-staging.schoolvision.io': 'config.westmoreland-staging.js',
          'purple-bay-0984eb910.2.azurestaticapps.net': 'config.westmoreland-staging.js',
          'windermere-staging.schoolvision.io': 'config.windermere-staging.js',
          'calm-ground-0a698501e.1.azurestaticapps.net': 'config.windermere-staging.js'
        };

        // Detect school from URL path
        var path = window.location.pathname.toLowerCase();
        var pathSegments = path.split('/').filter(function(s) { return s.length > 0; });
        var detectedSchool = null;
        var hostname = window.location.hostname.toLowerCase();

        if (window.location.hostname === 'localhost') {
          // Local development
          configFile = 'config.local.js';
        } else if (stagingHostMap[hostname]) {
          // Staging environment detected by hostname
          configFile = stagingHostMap[hostname];
          console.log('Staging environment detected:', hostname, '→', configFile);
        } else if (pathSegments.length > 0 && configMap[pathSegments[0]]) {
          // School identifier found in URL path
          detectedSchool = pathSegments[0];
          configFile = configMap[detectedSchool];
          // Save school preference in cookie (expires in 30 days)
          setCookie('ecommerce_school', detectedSchool, 30);
          console.log('Loading config for:', detectedSchool, '→', configFile);
        } else {
          // Check if we have a saved school preference
          var savedSchool = getCookie('ecommerce_school');
          if (savedSchool && configMap[savedSchool]) {
            configFile = configMap[savedSchool];
            console.log('Loading saved config for:', savedSchool, '→', configFile);
          } else {
            // Default to SchoolVision demo mode for unrecognized hostnames
            configFile = 'config.demo.js';
            console.log('Unrecognized hostname, loading demo mode:', hostname, '→', configFile);
          }
        }

        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = '<%= BASE_URL %>' + configFile + '?cb=' + cachebuster;

        // CRITICAL FIX: Set flag when config is loaded so Vue app waits
        script.onload = function() {
          window.ECOMMERCE_CONFIG_LOADED = true;
          console.log('✅ Config loaded:', configFile, '→ API URL:', window.VUE_CONFIG_API_ECOMMERCE);
        };

        script.onerror = function() {
          console.error('❌ Failed to load config:', configFile);
          window.ECOMMERCE_CONFIG_LOADED = true; // Allow app to proceed with fallback
        };

        document.head.appendChild(script);
      })();
    </script>

    <!-- makes the recaptcha work -->
    <!-- <script src="https://www.google.com/recaptcha/api.js?onload=vueRecaptchaApiLoaded&render=explicit async defer"
    async defer>
    </script> -->
  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
